<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>טופס מלאי יומי</title>
  <!-- React 18 + Babel from CDN -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom-client.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>tailwind.config={theme:{extend:{boxShadow:{glow:'0 10px 40px rgba(0,0,0,.08)'} }}};</script>
  <style>
    :root{--ink:#0f172a;--muted:#64748b}
    body{min-height:100vh}
    .name{word-break:break-word}
    .glass{backdrop-filter:saturate(180%) blur(8px)}
  </style>
</head>
<body class="bg-gradient-to-b from-rose-50 via-fuchsia-50 to-sky-50 text-slate-900 min-h-screen">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useMemo, useEffect } = React;

    // ===== Languages =====
    const LANGS = {
      he: {
        appTitle: "טופס מלאי יומי",
        subtitle: "קלט בליטרים/קופסאות. נשמר אוטומטית.",
        date: "תאריך",
        search: "חיפוש…",
        clear: "ניקוי",
        cold: "פס קר",
        hot: "פס חם",
        nines: "תשיעיות",
        note: (l) => `הערה (${l})`,
        generalNote: "הערה כללית",
        share: "שליחה בווצאפ",
        copy: "העתקה ללוח",
        resetAll: "איפוס מלא",
        resetCat: "איפוס קטגוריה",
        nameCol: "שם",
        qtyCol: "כמות (ל׳)",
        addCustom: "+ פריט מותאם",
        jumpToInput: "קפיצה לקלט",
        liters: "ליטרים",
        boxes: "קופסאות (2 ל׳)",
        total: "סה\"כ",
        unit: "ל׳",
        version: "גרסה סטטית – GitHub Pages",
        dailyTitle: (d) => `מלאי יומי – ${d}`,
        emoji: { cold: "🧊", hot: "🔥", nines: "🗂️" },
        shortages: "חוסרים",
      },
      en: {
        appTitle: "Daily Inventory Form",
        subtitle: "Liters & 2L boxes. Auto-saved.",
        date: "Date",
        search: "Search…",
        clear: "Clear",
        cold: "Cold Line",
        hot: "Hot Line",
        nines: "Nines",
        note: (l) => `Note (${l})`,
        generalNote: "General note",
        share: "Send via WhatsApp",
        copy: "Copy",
        resetAll: "Reset all",
        resetCat: "Reset category",
        nameCol: "Name",
        qtyCol: "Qty (L)",
        addCustom: "+ Custom item",
        jumpToInput: "Jump to input",
        liters: "Liters",
        boxes: "Boxes (2L)",
        total: "Total",
        unit: "L",
        version: "Static – GitHub Pages",
        dailyTitle: (d) => `Daily Inventory – ${d}`,
        emoji: { cold: "🧊", hot: "🔥", nines: "🗂️" },
        shortages: "Shortages",
      },
    };

    // ===== Categories + palette =====
    const CATEGORIES = [
      { id: "cold", labelKey: "cold" },
      { id: "hot", labelKey: "hot" },
      { id: "nines", labelKey: "nines" },
    ];

    const PALETTES = {
      cold: {
        bg: "from-cyan-100 via-sky-100 to-indigo-100",
        border: "border-cyan-300",
        ring: "ring-cyan-600",
        chip: "bg-gradient-to-r from-cyan-400 to-sky-500 text-white",
        btn: { plus: "bg-gradient-to-r from-cyan-600 to-sky-600 text-white hover:brightness-110", minus: "bg-white hover:bg-cyan-50" },
        accent: "text-cyan-700",
      },
      hot: {
        bg: "from-amber-100 via-orange-100 to-rose-100",
        border: "border-amber-300",
        ring: "ring-amber-600",
        chip: "bg-gradient-to-r from-amber-500 to-orange-600 text-white",
        btn: { plus: "bg-gradient-to-r from-amber-600 to-orange-600 text-white hover:brightness-110", minus: "bg-white hover:bg-amber-50" },
        accent: "text-amber-700",
      },
      nines: {
        bg: "from-emerald-100 via-teal-100 to-lime-100",
        border: "border-emerald-300",
        ring: "ring-emerald-600",
        chip: "bg-gradient-to-r from-emerald-500 to-lime-600 text-white",
        btn: { plus: "bg-gradient-to-r from-emerald-600 to-lime-600 text-white hover:brightness-110", minus: "bg-white hover:bg-emerald-50" },
        accent: "text-emerald-700",
      },
    };

    // ===== Default items (Hebrew) =====
    const DEFAULT_ITEMS = {
      cold: [
        "וואפו",
        "בייס שיטאקי",
        "ויני שיטאקי",
        "אמאזו",
        "סונומונו",
        "ויניגרט ווסאבי",
        "סודצ׳י פונזו",
      ],
      hot: [
        "דן מיסו",
        "מייפל קוג׳י",
        "גומה דארה",
        "קצואובושי טסויו",
        "שמן קומבו",
        "פונזו",
        "איולי יוזו קושו",
        "בייס קצבושי",
        "קרמל קצבושי",
        "טארה גרון",
        "טארה בקר",
        "טריאקי",
        "רוטב כרוב",
        "אגדאשי",
        "ניטסוקה",
        "סאקה מירין",
        "נוזל יוזו",
        "קומבו דאשי",
        "צ׳ילי אוממי",
      ],
      nines: [
        "יקיניקו",
        "טונקאצו",
        "חמאת טופנג׳ן",
        "שומר סונומונו",
        "פטריות מוחמצות",
        "צ׳ילי טארה",
        "דאי דאי",
      ],
    };

    // ===== English map =====
    const NAME_MAP_EN = {
      // cold
      "וואפו": "Wafu",
      "בייס שיטאקי": "Shiitake Base",
      "ויני שיטאקי": "Shiitake Vinaigrette",
      "אמאזו": "Amazu",
      "סונומונו": "Sunomono",
      "ויניגרט ווסאבי": "Wasabi Vinaigrette",
      "סודצ׳י פונזו": "Sudachi Ponzu",
      // hot
      "דן מיסו": "Dan Miso",
      "מייפל קוג׳י": "Maple Koji",
      "גומה דארה": "Goma Dare",
      "קצואובושי טסויו": "Katsuobushi Tsuyu",
      "שמן קומבו": "Kombu Oil",
      "פונזו": "Ponzu",
      "איולי יוזו קושו": "Yuzu-Kosho Aioli",
      "בייס קצבושי": "Katsuobushi Base",
      "קרמל קצבושי": "Katsuobushi Caramel",
      "טארה גרון": "Tare – Throat",
      "טארה בקר": "Tare – Beef",
      "טריאקי": "Teriyaki",
      "רוטב כרוב": "Cabbage Sauce",
      "אגדאשי": "Agedashi",
      "ניטסוקה": "Nitsuke",
      "סאקה מירין": "Sake–Mirin",
      "נוזל יוזו": "Yuzu Liquid",
      "קומבו דאשי": "Kombu Dashi",
      "צ׳ילי אוממי": "Umami Chili",
      // nines
      "יקיניקו": "Yakiniku",
      "טונקאצו": "Tonkatsu",
      "חמאת טופנג׳ן": "Topengen Butter",
      "שומר סונומונו": "Fennel Sunomono",
      "פטריות מוחמצות": "Pickled Mushrooms",
      "צ׳ילי טארה": "Chili Tare",
      "דאי דאי": "Daidai",
    };

    const LS_KEY = 'inv-form-static-v3';

    function initialState(){
      const byCat = {};
      CATEGORIES.forEach(c=>{
        byCat[c.id] = {};
        (DEFAULT_ITEMS[c.id]||[]).forEach(n=> byCat[c.id][n] = 0);
      });
      return {
        meta:{date:new Date().toISOString().slice(0,10)},
        lang:'he',
        search:'',
        items:byCat,
        custom:{cold:[],hot:[],nines:[]},
        notes:{noteCold:'',noteHot:'',noteNines:'',general:''}
      };
    }

    function App(){
      const [state,setState] = useState(()=>{
        try{ const s = JSON.parse(localStorage.getItem(LS_KEY)||'null'); return s||initialState(); }catch{ return initialState(); }
      });

      useEffect(()=>{ localStorage.setItem(LS_KEY, JSON.stringify(state)); },[state]);

      const langKey = (state.lang in LANGS)? state.lang : 'he';
      const t = LANGS[langKey];
      useEffect(()=>{ document.documentElement.setAttribute('dir', langKey==='he'?'rtl':'ltr'); document.documentElement.setAttribute('lang', langKey); },[langKey]);

      const setMeta=(k,v)=> setState(s=>({...s, meta:{...s.meta,[k]:v}}));
      const setNote=(k,v)=> setState(s=>({...s, notes:{...s.notes,[k]:v}}));
      const updateAmount=(cat,name,v)=> setState(s=>({...s, items:{...s.items, [cat]:{...s.items[cat], [name]:Math.max(0, Number.isFinite(v)?v:0)}}}));

      const addCustom=(cat)=> setState(s=>({...s, custom:{...s.custom, [cat]:[...s.custom[cat], {name:'',amount:0}]}}));
      const setCustom=(cat,idx,k,v)=> setState(s=>{ const arr=[...s.custom[cat]]; const cur={...arr[idx],[k]: k==='amount'? Math.max(0,Number(v)||0): v}; arr[idx]=cur; return {...s, custom:{...s.custom,[cat]:arr}};});
      const removeCustom=(cat,idx)=> setState(s=>({...s, custom:{...s.custom, [cat]: s.custom[cat].filter((_,i)=>i!==idx)}}));

      const clearCat=(cat)=> setState(s=> ({...s, items:{...s.items,[cat]:Object.fromEntries(Object.keys(s.items[cat]).map(k=>[k,0]))}, custom:{...s.custom,[cat]:[]}, notes:{...s.notes,[`note${cap(cat)}`]:''} }));
      const resetAll=()=> setState(initialState());

      const [q,setQ] = useState('');
      useEffect(()=>{ const id=setTimeout(()=> setState(s=>({...s, search:q})), 180); return ()=> clearTimeout(id); },[q]);

      const norm=(s)=> (s||'').toString().toLowerCase();
      const matches=(heName)=>{ if(!state.search) return true; const disp=displayName(heName, langKey); const n=norm(state.search); return norm(heName).includes(n)||norm(disp).includes(n); };

      const shareText = useMemo(()=> formatShareText(state), [state]);

      const doCopy = async ()=>{
        try{ await navigator.clipboard.writeText(shareText); alert(langKey==='he'? 'הועתק ללוח.' : 'Copied to clipboard.'); }catch{ alert(langKey==='he'? 'לא ניתן להעתיק בדפדפן זה.' : 'Copy failed in this browser.'); }
      };
      const doShare = ()=>{ const waText = formatShareText(state); const url = `https://wa.me/?text=${encodeURIComponent(waText)}`; window.open(url,'_blank'); };

      return (
        <div className="max-w-xl mx-auto px-3 py-4">
          <header className="sticky top-0 z-10 mb-4 flex items-center justify-between gap-3 bg-white/70 glass rounded-2xl px-3 py-2 shadow-glow">
            <div className="py-1">
              <h1 className="text-2xl font-extrabold tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-fuchsia-600 to-sky-600">{t.appTitle}</h1>
              <p className="text-xs text-slate-600">{t.subtitle}</p>
            </div>
            <button onClick={()=> setState(s=>({...s, lang: s.lang==='he'?'en':'he'}))} className="rounded-full border border-slate-300 px-3 py-1 text-sm bg-white shadow hover:shadow-md hover:-translate-y-0.5 transition">{langKey==='he'?'EN':'HE'}</button>
          </header>

          {/* Date + Search */}
          <section className="grid grid-cols-1 gap-3 mb-4">
            <label className="flex flex-col gap-1">
              <span className="text-sm">{t.date}</span>
              <input type="date" value={state.meta.date} onChange={(e)=> setMeta('date', e.target.value)} className="rounded-2xl border border-slate-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-slate-500 bg-white shadow-glow" />
            </label>
            <div className="flex items-center gap-2 flex-wrap">
              <div className="flex-1 rounded-full border border-slate-200 bg-white px-4 py-2 shadow-glow focus-within:ring-2 focus-within:ring-fuchsia-500">
                <div className="flex items-center gap-2">
                  <span className="opacity-70">🔎</span>
                  <input placeholder={t.search} value={q} onChange={(e)=> setQ(e.target.value)} className="w-full focus:outline-none bg-transparent" />
                  {q && <button onClick={()=> setQ('')} className="text-xs opacity-70 hover:opacity-100">{t.clear}</button>}
                </div>
              </div>
            </div>
          </section>

          {CATEGORIES.map(cat => (
            <CategoryCard key={cat.id}
              id={cat.id}
              label={`${t[cat.labelKey]} ${t.emoji[cat.id]}`}
              palette={PALETTES[cat.id]}
              lang={langKey}
              items={Object.fromEntries(Object.entries(state.items[cat.id]).filter(([name])=> matches(name)))}
              custom={(state.custom[cat.id]||[]).filter(row=> matches(row.name||''))}
              note={state.notes[`note${cap(cat.id)}`]}
              onNote={(v)=> setNote(`note${cap(cat.id)}`, v)}
              onAmount={(name,v)=> updateAmount(cat.id,name,v)}
              onAddCustom={()=> addCustom(cat.id)}
              onSetCustom={(idx,k,v)=> setCustom(cat.id,idx,k,v)}
              onRemoveCustom={(idx)=> removeCustom(cat.id,idx)}
              onClear={()=> clearCat(cat.id)}
              t={t}
            />
          ))}

          <section className="mt-4">
            <label className="flex flex-col gap-1">
              <span className="text-sm">{t.generalNote}</span>
              <textarea rows={3} value={state.notes.general} onChange={(e)=> setNote('general', e.target.value)} className="rounded-2xl border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-slate-500 bg-white" />
            </label>
            <div className="mt-4 grid grid-cols-2 gap-3">
              <button onClick={doShare} className="rounded-2xl px-4 py-3 font-medium bg-slate-900 text-white shadow hover:shadow-md hover:opacity-90">{t.share}</button>
              <button onClick={doCopy} className="rounded-2xl px-4 py-3 font-medium border border-slate-300 bg-white shadow hover:shadow-md">{t.copy}</button>
              <button onClick={resetAll} className="col-span-2 rounded-2xl px-4 py-3 font-medium border border-rose-300 text-rose-700 bg-white hover:bg-rose-50">{t.resetAll}</button>
            </div>
          </section>

          <footer className="text-center text-xs text-slate-500 mt-6 mb-2">{t.version}</footer>
        </div>
      );
    }

    function CategoryCard({ id, label, palette, lang, items, custom, note, onNote, onAmount, onAddCustom, onSetCustom, onRemoveCustom, onClear, t }){
      const names = Object.keys(items);
      return (
        <section id={id} className={`mb-4 rounded-3xl border ${palette.border} bg-gradient-to-br ${palette.bg} p-3 shadow-glow overflow-hidden`}>
          <div className="flex items-center justify-between gap-2 mb-2">
            <h2 className="text-lg font-semibold"><span className={`inline-flex items-center px-3 py-1 rounded-2xl ${palette.chip} shadow text-sm`}>{label}</span></h2>
            <button onClick={onClear} className="text-xs underline opacity-70 hover:opacity-100">{t.resetCat}</button>
          </div>
          <div className="flex items-center justify-between text-xs text-slate-600 px-1 mb-1"><span>{t.nameCol}</span><span>{t.qtyCol}</span></div>
          <ul className="space-y-3">
            {names.map((heName)=> (
              <li key={heName} className="bg-white/95 rounded-2xl border border-slate-200 px-3 py-3 shadow-glow">
                <div className="flex items-center gap-2 flex-wrap">
                  <div className="flex-1 min-w-[60%] sm:min-w-[50%]">
                    <div className="font-semibold whitespace-normal break-words leading-tight">{displayName(heName, lang)}</div>
                    {lang==='en' && <div className={`${palette.accent} text-xs opacity-80 whitespace-normal break-words`}>{heName}</div>}
                  </div>
                  <QuantityInput value={items[heName]} onChange={(v)=> onAmount(heName,v)} palette={palette} t={t} />
                </div>
              </li>
            ))}
            {custom.map((row,idx)=> (
              <li key={`c-${idx}`} className="bg-white/95 rounded-2xl border border-slate-200 px-3 py-3 shadow-glow">
                <div className="flex items-center gap-2 flex-wrap">
                  <input placeholder={t.addCustom.replace('+ ','')} value={row.name} onChange={(e)=> onSetCustom(idx,'name', e.target.value)} className="flex-1 min-w-[60%] sm:min-w-[50%] rounded-xl border border-slate-300 px-2 py-2 focus:outline-none focus:ring-2 focus:ring-slate-500" />
                  <QuantityInput value={row.amount} onChange={(v)=> onSetCustom(idx,'amount', v)} palette={palette} t={t} />
                  <button onClick={()=> onRemoveCustom(idx)} className="text-xs px-2 py-1 rounded-xl border border-slate-300 bg-white hover:bg-slate-50">{t.clear}</button>
                </div>
              </li>
            ))}
          </ul>
          <div className="mt-2 flex gap-2">
            <button onClick={onAddCustom} className={`rounded-xl px-3 py-2 text-sm font-medium ${palette.btn.plus}`}>{t.addCustom}</button>
            <button onClick={()=> focusFirstNumber(id)} className={`rounded-xl px-3 py-2 text-sm font-medium border ${palette.border} bg-white`}>{t.jumpToInput}</button>
          </div>
          <label className="block mt-3">
            <span className="text-sm">{t.note(label)}</span>
            <textarea rows={2} value={note} onChange={(e)=> onNote(e.target.value)} className="w-full rounded-2xl border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-slate-500 bg-white" />
          </label>
        </section>
      );
    }

    function QuantityInput({ value, onChange, palette, t }){
      const stepL = 0.5;
      const safeVal = Number.isFinite(value) ? value : 0;
      const boxes = Math.floor(safeVal / 2);
      const litersRemainder = roundTo(safeVal - boxes * 2, stepL);
      const setBoxes = (b)=> onChange(Math.max(0, roundTo(b,1)) * 2 + litersRemainder);
      const setLiters = (l)=> onChange(Math.max(0, roundTo(l,stepL)) + boxes * 2);
      const incBox = ()=> setBoxes(boxes + 1);
      const decBox = ()=> setBoxes(Math.max(0, boxes - 1));
      const incL = ()=> setLiters(litersRemainder + stepL);
      const decL = ()=> setLiters(Math.max(0, litersRemainder - stepL));
      const total = roundTo(boxes * 2 + litersRemainder, stepL);
      return (
        <div className="flex items-stretch gap-2 select-none flex-wrap sm:flex-nowrap w-full" id="qty-group">
          <div className="flex items-center gap-1 rounded-2xl border px-3 py-2 bg-white/90 shadow-glow min-w-[140px] justify-between">
            <div className="text-xs opacity-80 mr-1">📦 {t.boxes}</div>
            <div className="flex items-center gap-1">
              <button type="button" onClick={decBox} className={`px-3 py-1.5 rounded-full border ${palette.border} ${palette.btn.minus} transition`}>–</button>
              <input inputMode="numeric" pattern="[0-9]*" value={Number.isFinite(boxes)? boxes: 0} onChange={(e)=> setBoxes(Number(e.target.value.replace(/[^0-9]/g,''))||0)} className={`w-12 text-center rounded-lg border ${palette.border} px-2 py-1 focus:outline-none ${palette.ring} focus:ring-2`} aria-label={t.boxes} title={t.boxes} />
              <button type="button" onClick={incBox} className={`px-3 py-1.5 rounded-full ${palette.btn.plus} transition`}>+</button>
            </div>
          </div>
          <div className="flex items-center gap-1 rounded-xl border px-2 py-1.5 bg-white shadow-sm min-w-[120px] sm:min-w-[150px] justify-between">
            <div className="text-xs opacity-80 mr-1">🧃 {t.liters}</div>
            <div className="flex items-center gap-1">
              <button type="button" onClick={decL} className={`px-3 py-1.5 rounded-full border ${palette.border} ${palette.btn.minus} transition`}>–</button>
              <input inputMode="decimal" pattern="[0-9]*" value={Number.isFinite(litersRemainder)? litersRemainder: 0} onChange={(e)=> setLiters(Number(e.target.value.replace(/[^0-9.]/g,''))||0)} className={`w-14 text-center rounded-lg border ${palette.border} px-2 py-1 focus:outline-none ${palette.ring} focus:ring-2`} aria-label={t.liters} title={t.liters} />
              <button type="button" onClick={incL} className={`px-3 py-1.5 rounded-full ${palette.btn.plus} transition`}>+</button>
            </div>
          </div>
          <div className="flex items-center rounded-full bg-slate-900 text-white px-3 text-xs font-semibold sm:ml-auto mt-2 sm:mt-0 shadow">{t.total}:&nbsp;{total}&nbsp;{t.unit}</div>
        </div>
      );
    }

    // Utils
    function displayName(heName, lang){ return lang==='en' ? (NAME_MAP_EN[heName] || heName) : heName; }
    function roundTo(n, step){ const k=Math.round(n/step)*step; return Number(k.toFixed(2)); }
    function cap(s){ return s.charAt(0).toUpperCase()+s.slice(1); }
    function focusFirstNumber(categoryId){ const el = document.querySelector(`#${CSS.escape(categoryId)} input[inputmode="decimal"]`); el && el.focus(); }

    function formatShareText(state){
      const lang = (state.lang in LANGS)? state.lang : 'he';
      const t = LANGS[lang];
      const unit = t.unit; const lines=[]; lines.push(t.dailyTitle(state.meta.date)); lines.push('');
      for(const cat of CATEGORIES){
        const base = state.items[cat.id];
        const nonZero = Object.keys(base).filter(k=> Number(base[k])>0);
        const customNZ = (state.custom[cat.id]||[]).filter(r=> r.name && Number(r.amount)>0);
        if(nonZero.length || customNZ.length){
          const label = t[cat.labelKey];
          lines.push(label+':');
          nonZero.forEach(heName=>{ const v=Number(base[heName]); lines.push(`• ${displayName(heName,lang)} – ${v} ${unit}`); });
          customNZ.forEach(row=> lines.push(`• ${row.name} – ${Number(row.amount)} ${unit}`));
          lines.push('');
        }
      }
      const shortage=[];
      for(const cat of CATEGORIES){
        const base=state.items[cat.id];
        const zeros = Object.keys(base).filter(k=> !Number(base[k]));
        const customZeros = (state.custom[cat.id]||[]).filter(r=> r.name && !Number(r.amount));
        zeros.forEach(heName=> shortage.push(`• ${displayName(heName,lang)}`));
        customZeros.forEach(row=> shortage.push(`• ${row.name}`));
      }
      if(shortage.length){ lines.push(t.shortages+':'); lines.push(...shortage); }
      return lines.join('\n');
    }

    // Mount
    const container = document.getElementById('root');
    const createRoot = (window.ReactDOM && ReactDOM.createRoot) ? ReactDOM.createRoot : (window.ReactDOMClient && ReactDOMClient.createRoot);
    const root = createRoot(container);
    root.render(<App />);

    // Self-tests (minimal, runtime)
    setTimeout(()=>{
      try{
        const base = initialState();
        const text = formatShareText(base);
        console.assert(typeof text==='string' && /Shortages|חוסרים/.test(text), 'Share text composes');
      }catch(e){ console.warn('Self-test failed', e); }
    },0);
  </script>
</body>
</html>
